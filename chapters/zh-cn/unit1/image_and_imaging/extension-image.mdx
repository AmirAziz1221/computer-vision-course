# 真实场景中的图像采集

你是否尝试过为一窝小猫拍照？如果没有，那你将会错过一场既美妙又充满混乱的视觉盛宴。小猫是天生就惹人喜爱的生物，它们的一举一动都充满了意想不到的变化。它们会摆出各种萌态，但往往稍纵即逝，紧接着又会做出更可爱的举动。不知不觉中，你已向后弯腰，只为了将那一只小猫纳入镜头，同时还要调整变焦和相机的角度，而另一只小猫却在爬你的腿。你完全沉浸在它们的毛茸茸之中，根本无暇查看照片。当你终于坐下来查看时，却发现照片，全，都，是，模，糊，的。只有寥寥一两张值得保留在手机里。你只能在那儿感叹，我以为小猫应该更上相才对。

这窝小猫的故事看似简单，却反映了在现实生活中进行图像采集为何如此困难。场景样本（包含小猫的场景）变化的速度往往比相机调整的速度还要快。如果使用固定不动的相机，且不去追踪小猫，也很难拍清楚，因为作为拍摄主体的对象（小猫）在空间中的移动会影响相机的焦点。改变镜头来捕捉白色区域也可能导致失真，这取决于物体与相机的距离（见下面这个可爱的例子）。我们真正感兴趣的瞬间（小猫可爱的姿势）很容易淹没在数百张其他平平无奇的照片中。我们的小猫例子虽然略显稚拙，但这些困难在各种其他场景中同样存在。图像采集并非易事。然而，互联网上却充斥着各种可爱的猫咪照片。

![猫咪亲吻，展示了基于物体距离的失真](https://huggingface.co/datasets/hf-vision/course-assets/resolve/main/cat_kiss.gif)

人们很容易认为，只要拥有一台更好的相机，一台响应速度更快、分辨率更高的相机，所有问题便能迎刃而解，我们就能拍到我们想要的出色照片。此外，我们将利用本课程中的知识，不仅仅是为了捕捉所有可爱的小猫，我们还希望在保姆摄像头上构建一个模型，以检查小猫是否还和它们的妈妈在一起，确保它们都安全无恙。听起来很完美，不是吗？

在我们立刻冲出去购买市场上最新、最炫的相机，并天真地认为这样就能获得更好的数据，模型训练就会变得异常轻松，从而在小猫追踪领域取得卓越性能之前，请先稍作冷静。本段旨在引导你朝着更高效的方向前进，并可能为你节省大量时间和金钱。更高的分辨率并非解决所有问题的灵丹妙药。首先，用于处理图像的典型神经网络模型是卷积神经网络（CNN）。CNN 需要特定尺寸的图像。一张大尺寸图像需要一个大型模型，训练时间也会更长。而且，你的电脑很可能在内存（RAM）方面也存在限制。更大的图像尺寸意味着每次迭代可用于训练的图像数量减少，因为内存会受到限制。

一个显而易见的解决方案是购买一台具有更多 GPU 和更多 RAM 的计算机。这也意味着，除了购买相机之外，你还必须为用于训练小猫模型的服务支付更多费用。更普遍地说，这并不符合真实世界的场景。有时，计算机模型的实际应用场景是 GPU 和内存资源匮乏的环境。等等，这难道不是我们最初面临的困境吗？我们如何将模型部署到保姆摄像头的硬件中？

我们不妨考虑这样一个方案：尝试构建一个更小的模型，使其能够实现与大型模型相同的性能！事实上，这完全是可行的。即便如此，一味追求尽可能高的图像质量可能并非明智之举，因为它通常需要更长的获取和传输时间。50GB 的小猫照片仍然是 50GB 的数据，无论其内容多么可爱。另一个需要考虑的因素是，计算资源通常是付费的，或者是共享的。在前一种情况下，这可能并非对资金资源的有效利用。至于后一种情况，占用整个服务器资源很少是建立良好人际关系的好方法。

甚至还有一个更充分的理由不去盲目追求最高分辨率。与低分辨率图像相比，高分辨率图像可能包含更多的噪声。分辨率不仅放大了你捕捉感兴趣信号的能力，也放大了你拾取噪声的能力。因此，在较低分辨率的图像上进行学习可能更容易。较低的分辨率有助于实现更快的训练、更高的准确性以及更经济的模型，无论是在计算方面还是在资金方面。关键在于，在给定图像的噪声特性以及训练和部署模型所需的基础设施的前提下，选择尽可能高的分辨率。最后，我们为什么要一开始就使用高质量的相机呢？如果我们想在保姆摄像头上构建一个模型，直接从保姆摄像头获取图片似乎更为合理。

## 对万物进行成像

成像技术最令人叹为观止之处在于我们对它们的孜孜以求。我们似乎永不知足。这不仅体现在对小猫照片的追求上，也体现在我们对周围世界的探索中。我们天生就充满了好奇心。正如第一章所见，我们依赖视觉来做出决策。当面临艰难抉择时，我们希望能洞察一切（此处并无双关之意）。

毫不奇怪，作为一个物种，我们已经开发出超越肉眼所能捕捉范围的全新视觉方式。我们渴望看到大自然原本不让我们看到的东西。我可以近乎肯定地说，如果有什么东西是我们不确定它长什么样的，肯定有人正在尝试对其进行成像。

作为人类，我们只能看到光谱中极其有限的一部分，即所谓的可见光谱。下图清晰地展示了它的局限性：

![图像显示了与电磁波谱相比的可见光谱，来自 https://open.lib.umn.edu/intropsyc/chapter/4-2-seeing/](https://huggingface.co/datasets/hf-vision/course-assets/resolve/main/human_spectrum.jpg)

为了突破自然赋予我们的视觉限制，我们需要能够捕捉到该光谱之外的传感器。换言之，我们需要探测不同波长的电磁波。红外线（Infrared, IR）常被用于夜视设备和天文观测中。磁共振则利用强大的磁场和无线电波来对人体软组织进行成像。我们创造了不依赖光线来观察事物的方式。例如，电子显微镜使用电子以远高于传统光学显微镜的分辨率进行放大。超声波是另一个很好的例子。超声成像利用声波来创建内部器官和组织的详细实时图像，提供了一种超越标准光学成像方法所能实现的非侵入性和动态的视角。

随后，我们将巨大的镜头对准天空，用它们来观察曾经不可见和未知的物体。我们还通过构建 DNA 结构和单个原子的图像，将镜头对准微观世界。这两种仪器都基于操纵光线的原理。我们使用不同类型的反射镜或透镜，以我们感兴趣的特定方式弯曲和聚焦光线。

我们对观察事物有着如此强烈的执念，以至于科学家们甚至改变了某些动物的 DNA 序列，以便他们可以用一种特殊类型的蛋白质（绿色荧光蛋白, green fluorescence protein, GFP）来标记感兴趣的蛋白质。顾名思义，当特定波长的光照射样品时，GFP 会发出荧光信号。现在，科学家可以更容易地确定感兴趣的蛋白质在哪里表达，因为他们可以对其进行成像。

在此之后，人们致力于在更长的时间尺度内，以更高的分辨率改进该系统，并获得更多的通道。例如，目前的显微镜在一夜之间便可生成 TB 级别的数据。

下面这段视频就是一个很好的例子，它展示了如何结合以上多种技术。在视频中，你可以看到用荧光蛋白标记的鱼胚胎发育的 3D 图像投影的延时拍摄。你在图像上看到的每个彩色点都代表一个单独的细胞。

![鱼胚胎图像，改编自 https://www.biorxiv.org/content/10.1101/2023.03.06.531398v2.supplementary-material](https://huggingface.co/datasets/hf-vision/course-assets/resolve/main/fish.gif)

这种成像技术的多样性令人叹为观止。这些光学工具已经成为我们感知宇宙的眼睛，为我们提供了深刻的见解，彻底改变了我们对宇宙和生命本身的理解。我们每天都在使用它来发送我们所爱之人的照片，当他们不在身边时。当医生需要仔细观察时，我们会进行 X 射线检查。孕妇进行超声波检查以了解她们的宝宝的健康状况。我们设法对如黑洞般巨大的物体和如电子般微小的粒子进行成像，这听起来可能有些不可思议，甚至有些异想天开。但事实确实如此。

## 对成像的思考

正如我们之前所见，我们已经对不同的成像方式习以为常。这在现在看来已是司空见惯的事情，但它凝聚了我们大量的时间和精力。而且，我们似乎并没有放慢脚步，而是在不断地寻找新的观察方式和新的成像技术。随着我们不断构建新的仪器以更好地观察世界，新的故事和谜团将被我们重新审视。在本节中，我们将举例说明过去已被我们重新审视的一些谜团。

### 51 号照片

![51 号照片，作者：Raymond Gosling/伦敦国王学院](https://huggingface.co/datasets/hf-vision/course-assets/resolve/main/Photo_51_x-ray_diffraction_image.jpg)

DNA 的第一张照片，又称 51 号照片，是通过一种基于 DNA 纤维晶体凝胶的纤维衍射图像技术拍摄的。这张照片由在 Rosalind Franklin 指导下工作的研究生 Raymond Gosling 于 1952 年 5 月拍摄。它是 Watson 和 Crick 在 1953 年构建 DNA 双螺旋模型的关键组成部分。围绕这张照片存在诸多争议，部分争议来自于 Rosalind Franklin 的早期工作所做出的贡献未得到充分认可，以及这张照片被分享给 Watson 和 Crick 的情况。尽管如此，它极大地促进了我们对 DNA 结构的理解，并推动了此后相关技术的发展。

### 暗淡蓝点

![暗淡蓝点，作者：旅行者 1 号](https://huggingface.co/datasets/hf-vision/course-assets/resolve/main/Pale_Blue_Dot.png)

“暗淡蓝点”是 1990 年由一个太空探测器拍摄的一张照片。照片中，地球的尺寸非常小，甚至小于一个像素。这张照片因其展现了地球相对于浩瀚宇宙的渺小和短暂而广为人知，并启发 Carl Sagan 创作了《暗淡蓝点》一书。这张照片由旅行者 1 号上的 1500 毫米高分辨率窄角相机拍摄。该太空探测器还负责拍摄了著名的“太阳系全家福”。

### 黑洞

![M87，作者：事件视界望远镜](https://huggingface.co/datasets/hf-vision/course-assets/resolve/main/Black_hole_-_Messier_87.jpg)
另一个天文上具有里程碑意义的事件发生在 2019 年 4 月，当时研究人员发布了黑洞的第一张图像！ 这是位于室女座星系 M87 中心（距离地球约 5500 万光年）的超大质量黑洞的图像。这张非凡的图像是事件视界望远镜（Event Horizon Telescope）项目的成果，该项目由一个全球同步射电天文台网络组成，它们共同努力创建一个与地球一样大的虚拟望远镜。收集到的数据量极其庞大，超过 1PB，并且由于其数据量巨大，必须以物理方式传输以进行处理。研究人员需要结合来自近红外、X 射线、毫米波长和无线电波观测的数据。这一成就凝聚了事件视界望远镜合作组织多年来的辛勤付出。

![人马座 A，作者：事件视界望远镜](https://huggingface.co/datasets/hf-vision/course-assets/resolve/main/sag-event-image.jpg)

在 M87* 取得成功之后，天文学家们将目标对准了对我们银河系中心（人马座 A*, Sagittarius A\*) 的超大质量黑洞进行成像。对人马座 A* 进行成像面临着独特的挑战，因为它尺寸较小，并且其周围环境变化迅速，远快于 M87* 等较大黑洞周围的环境。这种快速运动使得难以捕捉到能够准确代表人马座 A* 周围结构的稳定图像，就像我们的小猫的例子一样！ 尽管存在这些挑战，但获得的图像对于在极端引力条件下验证爱因斯坦的广义相对论至关重要。虽然这些观测至关重要，但它们只是用于验证广义相对论预测的更广泛方法中的一部分。

### 图像，图像，图像

![从 DNA 中解码出的马的视频，来自 https://doi.org/10.1038/nature23017](https://huggingface.co/datasets/hf-vision/course-assets/resolve/main/horsegif_0.gif)

这算是一个有趣的题外话。它不涉及一种新的成像方式，而是一种新的读取和存档图像的方式。你所看到的 GIF 图像存储在活细菌的 DNA 中。这最初是由一群科学家在 2017 年完成的，旨在证明活生物体是存档数据的一种极佳方式。为此，他们首先将图像值转换为核苷酸代码（即著名的 ATCG）。然后，他们使用一种称为 CRISPR 的系统将该序列放入 DNA 中，该系统能够编辑 DNA。随后，他们重新测序 DNA 并重建了你看到的 GIF 图像。

这已经非常令人印象深刻了，但更令人惊叹的是，我们也可以看到它的实际应用！ 虽然不是这个精确的例子，但另一组科学家使用高速原子力显微镜来展示了它的工作原理。这种类型的显微镜使用机械连接到扫描仪的尖锐尖端。尖端与表面的相互作用会生成样品的拓扑结构描述，而所有这些都在纳米尺度上进行。下面的视频展示了 DNA 编辑器 CRIPR-Cas9 系统通过“咀嚼”DNA 来完成其第一步的过程。真是令人叹为观止！

![CRIPRS-Cas9 咀嚼 DNA，改编自 https://doi.org/10.1038/s41467-017-01466-8](https://huggingface.co/datasets/hf-vision/course-assets/resolve/main/cas_9.gif)

还有更多。你是否曾好奇科学家是如何对 DNA 进行成像的？ 信不信由你，这个过程也涉及成像。为了了解 DNA 序列，科学家需要先复制它。这些副本是通过用不同的荧光染料标记核苷酸（我们称之为 ATCG 的物质）来创建的。每个核苷酸一次与一个序列匹配。在添加它们时，相机会捕捉图像，荧光发出的颜色给出了添加的核苷酸类型。通过跟踪各个位置，我们可以重建 DNA 分子的序列。这种测序技术不仅仅是重建图像，它还用于理解不同的生物过程，并在临床环境中拥有广泛的应用。医生可以从这些序列中获得各种各样的信息。例如，可以对肿瘤样本进行测序，并用于将其分类为侵袭性的或非侵袭性的。 这将生成高度多维的数据。在这种高维设置下做出任何结论都非常困难，因此他们通常将这些数据简化为 2D 图像。这些 2D 图像可以像任何其他图像一样进行处理，这意味着你可以使用 CNN 对其进行分类。 令人难以置信，不是吗？

## 图像特征取决于采集方式

无论图像类型如何，所有图像都具有一些相同的基本特征，即它们代表空间分量，通常由矩阵表示。但是，务必认识到，图像的创建方式千差万别。图像的独特特征来源于主题和图像采集方法。换句话说，我们不应期望黑洞和 DNA 看起来一样。同样，我们也不应期望同一个人的照片和 X 射线图像看起来一样。

理解图像特征是构建计算机视觉模型的一个良好的开端。这不仅会影响计算机视觉模型的性能，而且会决定哪些模型更适合你的问题。值得注意的是，并非每种图像类型都需要开发新的神经网络架构。有时，你可以通过微调或操纵最后一层来执行不同的任务，从而使预先存在的模型适应你的需求。有时，无需进行此类操纵，只需采用预处理技术，使你的图像更接近网络训练所用的输入即可。现在无需过于担心这些细节，因为我们将在本课程的后续章节中进行详细介绍。在此提及这些内容是为了帮助你理解获取图像的上下文为何至关重要。

对于在不同波长但在相同坐标系中获取的图像，我们可以很容易地将每次采集视为不同的颜色通道。例如，在通过 X 射线和近红外线获取的图像中，你可以将它们视为不同的颜色通道。这样，每个图像都以其自身的灰度显示。

虽然这看起来很简单，但某些技术（如雷达和超声波）使用一种称为极坐标网格的独特坐标系。该网格源自信号发射的中心。与笛卡尔坐标系不同，极坐标网格中的像素大小并不一致。随着与中心距离的增加，该系统中的坐标也会增加。实际上，这意味着随着与中心距离的增加，像素代表更大的区域。针对这种情况，通常有两种处理方法。第一种是将坐标系更改为像素大小相同的坐标系。然而，这将导致大量信息的丢失，而这些信息可能并非十分重要，并且可能导致次优的存储系统。另一种方法是保持原样，但将与中心的距离作为模型的另一个输入添加。

这并不是坐标系发挥作用的唯一情况。另一种情况是卫星成像。当在相同坐标下捕获多个波长时，你可以将它们视为不同的颜色通道，正如我们之前所见。但是，当数据在不同的坐标系下时，情况会变得更加复杂。例如，将卫星图像和地球图像组合在一起以用于给定的任务。在这种情况下，需要将坐标重新映射到彼此。

最后，图像采集本身带有一系列的偏差。我们可以将偏差粗略地定义为数据集的不良特征，这些特征要么是噪声，要么会改变模型的行为。偏差有很多来源，但图像采集中一个常见的来源是测量偏差。当用于训练模型的数据集与你的模型实际应用中看到的数据集差异过大时，就会发生测量偏差，就像我们之前提到的小猫的高分辨率图像与保姆摄像头拍摄的图像的例子一样。可能还存在其他测量偏差的来源，例如来自标记人员的测量偏差（即，不同的组和不同的人以不同的方式标记图像），或者来自图像上下文的偏差（即，在尝试对猫和狗进行分类时，如果所有猫的图片都在沙发上，则该模型可能会学习区分沙发与非沙发，而不是猫和狗）。

总而言之，识别和解决源自不同仪器的图像特征是构建计算机视觉模型的一个良好的开端。在这种情况下，可以使用预处理技术和解决我们识别出的问题的策略来减轻其对模型的影响。“计算机视觉任务的预处理”一章将更深入地介绍用于增强模型性能的特定预处理方法。
